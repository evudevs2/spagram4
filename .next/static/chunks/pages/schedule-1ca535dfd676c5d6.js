(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6332],{7966:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/schedule",function(){return t(4128)}])},4128:function(e,a,t){"use strict";t.r(a);var s=t(5893),l=t(7294),i=t(9008),n=t.n(i),o=t(8894);t(1664);var r=t(1163),c=t(8433),d=t(4174),m=t(3033),h=t(3760),u=t(698);a.default=function(){let[e,a]=(0,l.useState)({name:"",email:"",phone:"",address:"",city:"",zip:"",password:"",selected_model:""}),[t,i]=(0,l.useState)({customer_id:"",model_id:"",service_address:"",service_type:"",service_time:"",amount_received:"",cardid:"",status:""}),[p,x]=(0,l.useState)(!1),[g,j]=(0,l.useState)(!1),[v,y]=(0,l.useState)(null),[_,f]=(0,l.useState)(null),[b,S]=(0,l.useState)(null),[C,w]=(0,l.useState)(!0),[N,k]=(0,l.useState)(null),[D,P]=(0,l.useState)(!1),[E,Z]=(0,l.useState)(null),[I,L]=(0,l.useState)(""),[T,z]=(0,l.useState)(!0),[F,q]=(0,l.useState)(null),[A,M]=(0,l.useState)(!1),[R,U]=(0,l.useState)(!0),[Y,$]=(0,l.useState)(),[B,O]=(0,l.useState)(!1),[W,X]=(0,l.useState)(!1),[G,H]=(0,l.useState)(!1),[J,K]=(0,l.useState)(!1),[Q,V]=(0,l.useState)(!1),[ee,ea]=(0,l.useState)(["9 am","10 am","11 am","12 pm","1 pm","2 pm","3 pm","4 pm","5 pm","6 pm","7 pm","8 pm","9 pm","10 pm","11 pm","12 am","1 am","2 am","3 am","4 am","5 am","6 am","7 am","8 am"]),[et,es]=(0,l.useState)({email:"",password:""}),el=t=>{a({...e,[t.target.name]:t.target.value})},ei=(0,r.useRouter)(),{singleApiUrl:en}=ei.query,eo=new URLSearchParams(en),er=eo.get("date"),ec=e=>{console.log("calltype selector func called");let a=e.target.value;if($(a),"inCall"==a){O(!0),X(!1);let e=b[0].incall_location;i({...t,service_address:e,service_type:"inCall"})}else X(!0),O(!1)},ed=e=>{H(e.target.value),i({...t,service_address:e.target.value,service_type:"outCall"})},em=t=>{a({...e,[t.target.name]:t.target.value})},eh=e=>(.1*parseFloat(e)).toFixed(2),eu=async e=>{e.preventDefault();try{console.log("incall location",b[0].incall_location,B),b[0].incall_location,console.log("orderdata before confirmorder ",t);let e=await c.Z.post("https://tsm.spagram.com/api/confirmorder.php",t);if(console.log("order retured",e.data),"1"==e.data.success){let{token:a}=e.data;localStorage.setItem("customertoken",a),window.location.href="/cardsaved"}}catch(e){console.error(e)}},ep=async a=>{a.preventDefault();try{let a=await c.Z.post("https://tsm.spagram.com/api/login-customer.php",e);if(console.log("rest",a.data),"1"==a.data.success){let{token:e}=a.data;console.log("retured after login",a.data),localStorage.setItem("customertoken",e),P(!0),i({...t,customer_id:e})}else L("Email/Password is not correct. Please try again or click to the button below to register. ")}catch(e){console.error(e)}},ex=async s=>{s.preventDefault(),w(!0),y("");try{e.selected_model=_;let s=await c.Z.post("https://tsm.spagram.com/api/register-customer.php",e);if(console.log("client data",e),console.log("rest",s.data),"1"==s.data.success){let{customerdbid:e,cardsaved:l}=s.data;localStorage.setItem("customerdbid",e),localStorage.setItem("cardsaved",l),localStorage.setItem("price",t.amount_received),i({...t,customer_id:e}),y("Your registration is successful"),K(!0),a({name:"",email:"",phone:"",address:"",city:"",zip:"",password:""}),console.log("insertedcustomer id",e),w(!1)}else w(!1),y("Error! Please contact support.")}catch(e){console.error(e)}},eg=()=>{let e=localStorage.getItem("customertoken");console.log("h",e),e&&(P(!0),i({...t,customer_id:e}))},ej=e=>{let a=new Date(e);a.setDate(a.getDate()+1);let t=a.getDate(),s=a.getMonth()+1+"/"+t+"/"+a.getFullYear();j(s),console.log("Tomorrow:",s),e_(_,s)},ev=()=>{let e=new Date,a=e.getDate(),t=e.getMonth()+1+"/"+a+"/"+e.getFullYear();return j(t),t},ey=e=>{let a=new Date(e);a.setDate(a.getDate()-1);let t=a.getDate(),s=a.getMonth()+1+"/"+t+"/"+a.getFullYear();j(s),console.log("Tomorrow:",s),e_(_,s)},e_=async(e,a)=>{try{let t="";if(""==a){let e=new URLSearchParams(en);t=e.get("date"),j(t),j(e.get("time"))}else t=a,j(a);console.log("cdate",t);let s=await c.Z.get("https://tsm.spagram.com/api/availability.php?modelid="+e+"&date="+t);if(console.log("availdata","https://tsm.spagram.com/api/availability.php?modelid="+e+"&date="+t,s.data),q(s.data),"1"==s.data.success){let{token:e}=s.data}}catch(e){console.error(e)}},ef=[];ee.map(e=>{F&&F.includes(e)?ef.push((0,s.jsxs)("div",{onClick:()=>eb(e),className:"available",children:[" ",e," "]})):ef.push((0,s.jsxs)("div",{className:"notavailable",children:[" ",e," "]}))});let eb=e=>{x(e);let a=eh(b[0].price),s="";s=""!=g?g:ev(),console.log("todays date",ev()),i({...t,service_time:s+", "+e,amount_received:a,cardid:"",status:"Initiated"})};return(0,l.useEffect)(()=>{eg();let e=async()=>{try{let e=await c.Z.get(en);S(e.data),new URLSearchParams(en);let a=en.split("=")[1];console.log("modid, di",a),a=a.split("&")[0],console.log("modid, di",a),f(a),i({...t,model_id:a}),console.log("surl",en),console.log("sdata",e.data),e_(a,""),k(null)}catch(e){k(e.message),S(null)}finally{w(!1)}};console.log("date and time",g,"---",p),e()},[en]),(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(n(),{children:(0,s.jsx)("title",{children:" Book a model "})}),(0,s.jsxs)("div",{className:"bookingpage",children:[(0,s.jsxs)("div",{className:"modelInfoCnt",children:[(0,s.jsx)("h1",{children:"   "}),C&&(0,s.jsx)("div",{children:"Loading..."}),N&&(0,s.jsx)("div",{children:"There is a problem fetching the post data - ".concat(N)}),b&&(0,s.jsx)(d.Z,{...b}),(0,s.jsx)(u.Z,{})]}),p?(0,s.jsx)("div",{className:"forms",children:(0,s.jsx)("div",{children:D?(0,s.jsxs)("div",{className:"order-box",children:[(0,s.jsxs)("div",{className:"order-summary",children:[(0,s.jsxs)("p",{children:[" Selected Date/Time: ",(0,s.jsxs)("strong",{children:[" ",""==g?ev():g," | ",p," "]})," ",(0,s.jsx)("span",{className:"anchor",onClick:()=>x(!1),children:" Change "})," "]}),(0,s.jsxs)("p",{children:[" Price: $",eh(b[0].price)," (10% of $",b[0].price," )  "]})]}),(0,s.jsxs)("p",{children:[" Use the Saved card "," ","  "]}),(0,s.jsx)("a",{onClick:()=>M(!0),children:" Use a new debit/credit card "}),A?(0,s.jsx)("div",{className:"cardform",children:(0,s.jsx)(h.Z,{})}):"",(0,s.jsx)("br",{}),(0,s.jsx)("a",{className:"button",onClick:eu,children:" Reserve the Appointment   "}),(0,s.jsxs)("p",{children:[" ",v," "]})]}):(0,s.jsx)("div",{className:"col2 bookarea",children:T?(0,s.jsxs)("div",{className:"registration-container",children:[(0,s.jsxs)("p",{className:"selected_label",children:["Selected date: ",g||er,", Time: ",p," ",(0,s.jsx)("span",{className:"anchor",onClick:()=>x(!1),children:" Change "}),"  "]}),(0,s.jsxs)("form",{onSubmit:ep,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{children:" Login to Book an Appointment "}),(0,s.jsx)("label",{children:"Email:"}),(0,s.jsx)("input",{type:"email",id:"email",name:"email",onChange:el,required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{children:"Password:"}),(0,s.jsx)("input",{type:"password",id:"password",name:"password",onChange:el,required:!0})]}),(0,s.jsx)("button",{className:"button",type:"submit",children:"Submit"}),(0,s.jsxs)("p",{className:"message",children:[" ",E]})]}),(0,s.jsxs)("p",{children:[" ",I," "]}),(0,s.jsx)("div",{className:"button",onClick:()=>z(!1),children:" Not a member? Click to register "})]}):J?(0,s.jsxs)("div",{className:"registration-container",children:[(0,s.jsx)("h3",{children:" Enter your card details "}),(0,s.jsx)("p",{children:" We will save your card in a Square secure server and charge you after the model accept your request "}),(0,s.jsx)(h.Z,{customer_id:t.customer_id,model_id:t.model_id,service_address:t.service_address,service_type:t.service_type,service_time:t.service_time,price:t.amount_received,showSuccessPage:Q})]}):(0,s.jsxs)("div",{className:"registration-container",children:[(0,s.jsx)("h2",{children:" Fill the form "}),(0,s.jsxs)("form",{onSubmit:ex,children:[(0,s.jsx)("label",{for:"name",children:"Name:"}),(0,s.jsx)("input",{type:"text",id:"name",onChange:em,name:"name",value:e.name}),(0,s.jsx)("label",{for:"email",children:"Email:"}),(0,s.jsx)("input",{type:"email",id:"email",onChange:em,name:"email",value:e.email}),(0,s.jsx)("label",{for:"phone",children:"Phone: (Don't add country code +1, don't add white space ) "}),(0,s.jsx)("input",{type:"tel",id:"phone",onChange:em,name:"phone",value:e.phone}),(0,s.jsx)("label",{for:"address",children:"Address:"}),(0,s.jsx)("textarea",{id:"address",onChange:em,name:"address",value:e.address}),(0,s.jsx)("label",{for:"city",children:"City:"}),(0,s.jsx)("input",{type:"text",id:"city",onChange:em,name:"city",value:e.city}),(0,s.jsx)("label",{for:"zip",children:"Zip:"}),(0,s.jsx)("input",{type:"text",id:"zip",onChange:em,name:"zip",value:e.zip}),(0,s.jsx)("label",{for:"name",children:"Create Password:"}),(0,s.jsx)("input",{type:"password",id:"password",onChange:em,name:"password",value:e.password}),(0,s.jsx)("input",{type:"hidden",id:"selected_model",name:"selected_model",value:_}),(0,s.jsx)("button",{className:"button",type:"submit",children:"Submit"}),C&&(0,s.jsx)(m.Z,{}),(0,s.jsxs)("h2",{children:[" ",v," "]})]}),(0,s.jsx)("div",{className:"button",onClick:()=>z(!0),children:" Member? Click to login "})]})})})}):(0,s.jsxs)("div",{className:"date-selector",children:[(0,s.jsxs)("h2",{className:"mktitle",children:[" Make an Appointment with ",b&&b[0].name," "]}),(0,s.jsxs)("p",{className:"smallfont",children:[" We will charge you $",b&&eh(b[0].price)," (10% of $",b&&b[0].price,")  "]}),(0,s.jsx)("p",{children:" Select Call type "}),b&&(()=>{let e=b[0].location_type,a=e.split(",");return(0,s.jsxs)("div",{className:"calltypeCnt",children:[(0,s.jsxs)("div",{className:"calltypes",children:[" ",a.length<2?(0,s.jsxs)("select",{onChange:ec,children:[(0,s.jsx)("option",{children:"inCall/outCall"}),(0,s.jsx)("option",{children:a[0]})]}):(0,s.jsxs)("select",{onChange:ec,children:[(0,s.jsx)("option",{children:"inCall/outCall"}),(0,s.jsx)("option",{children:a[0]}),(0,s.jsx)("option",{children:a[1]})]}),"  "]}),(0,s.jsxs)("div",{children:[" ",Y?"inCall"==Y?" Incall Location: "+b[0].incall_location:(0,s.jsxs)("div",{children:[" ",(0,s.jsx)("input",{type:"text",onChange:ed,placeholder:"Enter Outcall Location",name:"outcall_location"})," "]}):""," "]}),(0,s.jsx)("div",{children:"  "})]})})(),(0,s.jsxs)("div",{className:"date-changer",children:[(0,s.jsx)("a",{onClick:()=>ey(g||er),children:" Back \xa0\xa0 "}),(0,s.jsxs)("strong",{children:["  ",g||er," "]}),(0,s.jsx)("a",{onClick:()=>ej(g||er),children:" \xa0\xa0 Next "})]}),(0,s.jsx)("div",{children:" Select Green box. if All is booked then click next button above "}),(0,s.jsx)("div",{className:"timeCardCnt",children:ef})]})]})]})}}},function(e){e.O(0,[1664,5291,8433,959,6148,2328,9774,2888,179],function(){return e(e.s=7966)}),_N_E=e.O()}]);